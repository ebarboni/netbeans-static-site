<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Учебный курс по средству профилирования в среде IDE NetBeans 4.0</title>
<META NAME="description" CONTENT="NetBeans IDE 4.0 Profiler Tutorial">
<link rel="stylesheet" type="text/css" href="../../netbeans.css">
<META NAME="EXPIRES" CONTENT="N">
<meta name="author" content=""/>
<meta name="indexed" content="y"/>
<meta name="description" content="NetBeans IDE 4.0 Profiler Tutorial"/>
</head>
<body>
<h1>Учебный курс по средству профилирования в среде IDE NetBeans 4.0</h1>
<div class="articledate" style="margin-left:0px;">Представлено Греггом Спораром (Gregg Sporar) в рамках конкурса <a href="../win-with-netbeans.html">Выигрывай с NetBeans</a></div>
<p>Эта статья относится к средству профилирования NetBeans Milestone 5. 

<p>Средство профилирования NetBeans представляет собой мощный инструмент, предоставляющий важные данные о поведении приложения во время выполнения. Оказывая лишь небольшое влияние на эффективность работы системы, средство профилирования NetBeans отслеживает производительность ЦП и использование памяти. В этом учебном курсе мы продемонстрируем способы использования средства профилирования в NetBeans 4.0, позволяющие:</p>

<ul>
  <li><a href="#runtime">отслеживать поведение веб-приложения;</a></li>
  <li><a href="#cpu">определять время ЦП, используемое методами приложения;</a></li>
  <li><a href="#createObjects">отслеживать создание объектов приложением.</a></li>
</ul>

<p>Отрывки из этого учебного курса изначально появились в статье о JFluid, основной технологии средства профилирования NetBeans, в журнале <i>Java Developer's Journal</i> в июне 2004 г. (http://sys-con.com/story/?storyid=45081&amp;DE=1). Все переиздания опубликованы с разрешения издателя <i>Java Developer's Journal</i>.</p>

<p><a name="top"></a>На выполнение данного учебного курса потребуется около часа.</p>

<h2><a name="genericsetup"></a>Настройка среды</h2></br><br />
<div class="indent">
<h3 class="tutorial">Установка средства профилирования</h3>
<p>

Средство профилирования NetBeans доступно для отдельной загрузки в бета-версии. Для выполнения данного учебного курса необходимо установить последнюю версию средства профилирования NetBeans. Не забывайте следовать <a href="http://profiler.netbeans.org/index.html">указаниям по загрузке и установке</a> средства профилирования NetBeans.
</p>
<h3 class="tutorial"><a name="tomcat"></a>Настройка Tomcat</h3>
<p>

Профилирование веб-приложения требует выполнения веб-сервера с пакетом JDK, включающим в себя средство профилирования NetBeans. Так что для использования средства профилирования на сервере Tomcat, связанном с NetBeans, требуется произвести небольшое изменение в принципе запуска Tomcat. Самым простым способом будет изменить сценарий запуска Tomcat. Файл сценария называется catalina.bat (в системе Windows) или catalina.sh (в системе Unix). Сценарии размешены в папке bin сервера Tomcat; типичное местоположение в системе Windows: <br>
  <pre class="examplecode">
  C:\Program Files\netbeans-4.0\nb4.0\jakarta-tomcat-5.0.28\bin\catalina.bat</pre>
  А путь к файлу в Unix должен выглядеть примерно так:
  <pre class="examplecode">
  /export/home/gs/tools/netbeans/40/nb4.0/jakarta-tomcat-5.0.28/bin/catalina.sh</pre>
  <ol>
     <li>Сохраните резервную копию сценария.</li>
     <p><li>Добавьте прямо под блоком комментариев, т.е. в верхней части файла строку, которая устанавливает <tt>JAVA_HOME</tt> в папке, содержащей пакет JDK со средством профилирования NetBeans. Выберите в NetBeans команду &quot;Средство профилирования&quot; &gt; &quot;Справка&quot; &gt; &quot;О средстве профилирования&quot;, чтобы отобралось имя папки. Пример значения в Windows:
     <pre class="examplecode">
    set JAVA_HOME=c:\Documents and Settings\gs\.netbeans\4.0\modules\profiler-ea-vm\</pre>
     Пример значения в Unix:
     <pre class="examplecode">
    JAVA_HOME=&quot;/home/gs/.netbeans/4.0/modules/profiler-ea-vm/&quot;
</pre></li>
  </ol>
</p>
<h3 class="tutorial">Получение необходимых исходных файлов</h3>
<p>
В данном учебном курсе используется веб-приложение на основе проекта HelloWeb, созданного в рамках <a href="../../kb/archive/index.html">Руководство по началу работы с веб-приложениями в среде IDE NetBeans 4.0</a>. В данном учебном курсе также используется сервлет, обрабатывающий входящие запросы. Создаются компоненты Java, которые затем отправляются в JSP, где создается ответ. Сервлет нарочно написан очень простым кодом, чтобы подчеркнуть функции средства профилирования NetBeans.

<p>Все файлы приложения можно загрузить в архиве <tt>ProfilingTutorial.zip</tt>.</p>
<ol>
  <li>Создайте в файловой системе папку для распакованных файлов приложения. С нынешнего момента папка будет называться <tt><i>$</i><i>UNZIPHOME</i></tt>.</li>
  <p><li>Щелкните <tt><a href="https://netbeans.org/files/documents/4/387/ProfilingTutorial.zip">здесь</a></tt>, чтобы загрузить файл <tt>ProfilingTutorial.zip</tt>.</li><p></p>
  <p><li>Распакуйте архив <tt>ProfilingTutorial.zip</tt> в папку <tt><i>$</i><i>UNZIPHOME</i></tt>.</li><p></p>
  <p>Теперь в папке <tt><i>$</i><i>UNZIPHOME</i></tt> содержатся папки <tt>web</tt> и <tt>src</tt>. Папка <tt>web</tt> содержит два файла JSP и дескрипторы развертывания. Папка <tt>src</tt> содержит исходные файлы для сервлета и классов компонента Java.</p>
</ol>
</div>

<h2><a name="create"></a>Создание проекта</h2></br><br />
<div class="indent">
<h3 class="tutorial">Создание веб-проекта на основе предоставленных исходных файлов</h3>
 <ol>
  <li>Выберите &quot;Файл &gt; Новый проект&quot; (CTRL+SHIFT+N). В области &quot;Категории&quot; выберите &quot;Web&quot;. Выберите в меню &quot;Проекты&quot; пункт &quot;Веб-проект с существующими исходными файлами&quot;. Нажмите кнопку &quot;Далее&quot;.</li><p>
  <li>Нажмите в поле &quot;Местоположение&quot; кнопку &quot;Обзор&quot;, чтобы выбрать корневой каталог документации веб-приложения. Корневой каталог документа &mdash; <tt><i>$</i><i>UNZIPHOME</i></tt>, папка, в которую был распакован архив <tt>ProfilingTutorial.zip</tt>.</li><p>
  <li>В качестве имени проекта введите текст <tt>ProfilingTutorial</tt>. Нажмите кнопку &quot;Далее&quot;.</li><p>
  <li>Нажмите кнопку &quot;Готово&quot;. В среде IDE создается папка проекта <tt><i>$</i><i>UNZIPHOME/nbproject</i></tt> и файл <tt><i>$</i><i>UNZIPHOME/build.xml</i></tt>. Проект ProfilingTutorial откроется в среде IDE. Его логическую структуру можно просмотреть в окне &quot;Проекты&quot;, а файловую структуру &mdash; в окне &quot;Файлы&quot;.</li><p>
  <li>Последний шаг требуется только если платформа NetBeans настроена для пакета JDK v5 как платформы Java по умолчанию. <p>
    <ol type="i">
    <li>Текущее средство профилирования поддерживает файлы .class, созданные пакетом JDK v1.4.2, так что если вы не установили версию v1.4.2 пакета JDK и не настроили ее в качестве платформы NetBeans Java, будет необходимо это сделать. Обратите внимание, что в бета-версии средство профилирования NetBeans устанавливает пакет JDK на основе версии v1.4.2 - мы определили его как <tt>JAVA_HOME</tt> в действии <a href="#tomcat"> Настройка Tomcat</a>. Для получения дополнительных сведений просмотрите интерактивную <a href="http://profiler.netbeans.org/docs/help/index.html">справку по средству профилирования</a>.<p>
    <li>Щелкните правой кнопкой мыши в окне &quot;Проекты&quot; запись <tt>ProfilingTutorial</tt> и выберите пункт &quot;Свойства&quot;. Выберите платформу Java, для которой используется пакет v.1.4.2 JDK, и нажмите кнопку &quot;ОК&quot;.  </li><p>
     <li>Сохраните в папке bin Tomcat резервную копию файла catalina.50.bat (в Windows) или catalina.50.sh (в Unix).</li><p>
     <li>Внесите изменения в файл catalina.50.bat (в Windows) или catalina.50.sh (в Unix), которые мы выполнили в действии <a href="#tomcat">Настройка Tomcat</a>.</li><p>
     </ol>
</li>
  </ol>
  </div>
<h3 class="tutorial">Выполнение проекта</h3>

<ol>
<li>Щелкните в окне &quot;Проекты&quot; правой кнопкой мыши запись <tt>ProfilingTutorial</tt> и выберите команду &quot;Очистить и построить проект&quot;. Снова щелкните запись <tt>ProfilingTutorial</tt> правой кнопкой мыши и выберите пункт &quot;Выполнить проект&quot;. В результате в среде IDE будет построен проект, запустите Tomcat и откройте страницу index.jsp в окне обозревателя.</li><p>
<li>Убедитесь, что Tomcat запустился, открыв вкладку &quot;Встроенный Tomcat&quot; в окне вывода среды IDE. Прокрутите окно вывода Tomcat вверх, чтобы убедиться, что сервер Tomcat запустился при помощи JVM средства профилирования NetBeans. Проверьте строку, начинающуюся с текста <tt>Использование JAVA_HOME</tt>; домашний каталог Java должен быть папкой, содержащей JVM средства профилирования NetBeans. Если сервер Tomcat не запустился или каталог <tt>JAVA_HOME</tt> не содержит JVM средства профилирования NetBeans, убедитесь в соблюдении указаний действия <a href="#tomcat">Настройка Tomcat</a>. Образец выходного сообщения в Windows представлен на рисунке ниже.

<p><a href="../../images_www/articles/win-with-netbeans/tomcat.png" title="Окна просмотра Tomcat - щелкните, для просмотра полного изображения"><img src="../../images_www/articles/win-with-netbeans/tomcat-small.png" width="500" height="121" alt="Окно просмотра Tomcat - щелкните, для просмотра полного изображения" vspace="5" hspace="5" class="b-none" style="display: block; margin-left:auto; margin-right:auto;"></a></li>

<p><li>В окне обозревателя должна открыться и отображаться страница <tt>http://localhost:8084/ProfilingTutorial/</tt>. Убедитесь, что веб-приложение работает, введя в поле имени текст <tt>NetBeans User</tt> и нажав кнопку &quot;ОК&quot;. Результат должен быть похож на изображенный ниже. <img src="../../images_www/articles/win-with-netbeans/hello.png" class="align-center" alt="Вывод приложения" vspace="5" style="display: block; margin-left:auto; margin-right:auto;"></li><p>
</ol>
</div>

<h2><a name="runtime"></a>Отслеживание поведения во время выполнения</h2></br><br />
<div class="indent">
<h3 class="tutorial">Подключение к выполняемому приложению</h3>
 <p>
 Теперь, когда мы убедились, что сервер Tomcat использует JVM, включенную в средство профилирования NetBeans, можно подключить к JVM средства профилирования среды IDE и отслеживать ее поведение во время выполнения.
  <ol>
 <li>Выберите элементы &quot;Профиль&quot; &gt; &quot;Подключить средство профилирования&quot;. Появится диалоговое окно &quot;Указать параметры подключения&quot;.</li>
 <p><li>Для параметра &quot;Подключить к:&quot; выберите значение &quot;Сервер J2EE Web/App&quot;</li>
 <p><li>Для параметра &quot;Выполнение на:&quot; установите флажок &quot;Этот компьютер&quot;</li>
 <p><li>Для параметра &quot;Настройки подключения&quot; выберите значение &quot;Динамическое подключение&quot; и установите флажок &quot;Выбрать выполняемую виртуальную машину&quot;. Выберите запись Tomcat (обычно <tt>org.apache.catalina.startup.Bootstrap start</tt>) в списке виртуальных машин.</li>
 <p><li>В поле &quot;Рабочий каталог&quot; введите полное уточненное имя каталога bin на сервере Tomcat. Например, в системе Windows типичное значение может выглядеть следующим образом: <br>
  <pre class="examplecode">
  C:\Program Files\netbeans-4.0\nb4.0\jakarta-tomcat-5.0.28\bin</pre>
  В системе Unix значение будет выглядеть примерно так:
  <pre class="examplecode">
  /export/home/gs/tools/netbeans/40/nb4.0/jakarta-tomcat-5.0.28/bin</pre>
  </li>
  <p><li>Нажмите кнопку &quot;ОК&quot;. Появится диалоговое окно &quot;Подключение и профилирование&quot;.</li>
  <p><li>Нажмите кнопку &quot;Отслеживание приложения&quot;. Убедитесь, что параметр &quot;Разрешить мониторинг подпроцессов&quot; <i>отключен</i>.  </li><p>
  <li>Нажмите кнопку &quot;Подключить&quot;.</li>
 </ol>

 <h3 class="tutorial"><a name="interpretingMonitor">Интерпретация графиков мониторинга</a></h3>
 Средство профилирования NetBeans отображает в окне вывода три графика, примеры которых приведены ниже.

<p><a href="../../images_www/articles/win-with-netbeans/monitorGraphs.png" title="Графики мониторинга - щелкните для просмотра полного изображения"><img src="../../images_www/articles/win-with-netbeans/monitorGraphs-small.png" width="500" height="110" class="align-center" alt="Графики мониторинга - щелкните для просмотра полного изображения" vspace="5" hspace="5" class="b-none" style="display: block; margin-left:auto; margin-right:auto;"></a>

 <p>График слева проще всего расшифровать. Красный цвет обозначает размещенный размер кучи JVM, который обновляется каждую секунду. Фиолетовым цветом обозначен фактически используемый объем кучи. В примере, приведенном выше, размер размещенной кучи на момент последнего обновления был почти 14 Мб. Из 14 Мб фактически для хранения объектов Java использовалось 4 Мб.</p>
 <p>График справа также прост для понимания. На нем изображено число активных потоков в JVM, обновляемых один раз в секунду.</p>
 <p>График в центре представляет наибольший интерес. На нем изображены две важные статистики кучи.
 <ul>
 <li>Голубая линия обозначает процент времени выполнения, затраченного JVM на сборку мусора, который отображается на графике относительно оси Y справа. Время, затраченное JVM на сборку мусора, &mdash; это время, в течение которого приложение не может быть запущено. Поэтому если голубая линия показывает высокий процент, возможно, требуется настроить в JVM больший размер кучи (просмотрите <a href="http://java.sun.com/j2se/1.5.0/">документацию</a> по параметру -Xmx) или сменить <a href="http://java.sun.com/docs/hotspot/gc1.4.2/">алгоритм</a> сборки мусора.</li><p>
<li>
 Красная линия &mdash; это сохранившиеся поколения, которые отображены на графике относительно оси Y слева. Число сохранившихся поколений - это число различных поколений объектов Java в куче JVM, где под &quot;поколением&quot; подразумевается число коллекций мусора, сохранившихся в объекте. Если число сохранившихся поколений мало, это означает, что большинство объектов кучи функционировали примерно одно и то же количество времени. Однако если число сохранившихся поколений с течением времени существенно возрастает, это означает, что приложение размещает новые объекты, сохраняя связи со многими старыми объектами, которые уже были размещены. Если эти старые объекты на самом деле больше не требуются, в приложении происходит утечка памяти.
 </li>
 </ul>
 Нажатие на кнопку <img src="../../images_www/articles/win-with-netbeans/telemetryGraphsButton.png" alt="Кнопка просмотра графиков телеметрии" > &mdash; в среде IDE будут выведены более крупные версии этих трех графиков в главном окне вывода.<p>
</div>

<h2><a name="cpu"></a>Определение времени ЦП, используемого методом</h2></br><br />
<div class="indent">
<h3 class="tutorial">Переключение в режим анализа производительности</h3>
<p>

 Средство профилирования подключается к JVM на сервере Tomcat, однако только отслеживает статистику на высоком уровне. Чтобы получить подробные сведения о производительности определенного метода (или методов) приложения, необходимо изменить параметры средства профилирования.
 <ol>
 <li>Нажмите кнопку <img src="../../images_www/articles/win-with-netbeans/modifyProfilingButton.png" alt="Кнопка для просмотра окна изменения профилирования" > или выберите элементы &quot;Профиль&quot; &gt; &quot;Изменить профилирование&quot;.<p></li>
 <li>Нажмите кнопку &quot;Проанализировать производительность&quot;<p></li>
 <li>Выберите переключатель &quot;Часть приложения&quot;. Затем нажмите кнопку &quot;Выбрать&quot; рядом с переключателем &quot;Часть приложения&quot;.<p></li>
 <li>Нажмите кнопку &quot;Добавить&quot;.<p></li>
 <li>Нажмите кнопку &quot;Выбрать&quot;. В окне средства профилирования отобразится дерево выбора класса.<p></li>
 <li>Разверните запись ProfilingTutorial, щелкнув значок плюса.<p></li>
 <li>Разверните запись &quot;Исходные пакеты&quot;, щелкнув значок плюса.<p></li>
 <li>Разверните запись org.me.hello.<p></li>
 <li>Разверните запись RequestHandler.java.<p></li>
 <li>Щелкните запись RequestHandler и нажмите кнопку &quot;ОК&quot;.<p></li>
 <li>Методы в классе RequestHandler теперь отображаются в диалоговом окне &quot;Выбрать методы&quot;, как показано на рисунке ниже. Щелкните метод <tt>processRequest</tt> и нажмите кнопку &quot;ОК&quot;.

<p><img src="../../images_www/articles/win-with-netbeans/selectMethods.png" alt="Просмотр диалогового окна &quot;Выбрать методы&quot;" vspace=5 style="display: block; margin-left:auto; margin-right:auto;"></li>

<p><li>Выберите метод <tt>processRequest</tt>, щелкнув его в списке &quot;Корневые методы&quot;, и нажмите кнопку &quot;ОК&quot;. Сейчас мы выбрали метод <tt>processRequest</tt> в качестве корневого метода для анализа производительности. Это означает, что будет отслеживаться метод <tt>processRequest</tt> все вызываемые им методы, а также, все методы, вызываемые, в свою очередь, вызванными методами и т.д. Начиная с метода <tt>processRequest</tt>, средство профилирования анализирует график вызовов метода, чтобы определить методы, для которых требуется профилирование. Профилируются только эти методы &mdash; остальная часть приложения продолжает работать без потери производительности из-за профилирования.<p></li>
 <li>Нажмите в диалоговом окне &quot;Изменить профилирование&quot; кнопку &quot;ОК&quot;.<p></li>
 </ol>
<h3 class="tutorial">Выполнение профилированного метода</h3>
<p>

 Теперь, когда мы выбрали метод <tt>processRequest</tt> в качестве корневого метода, необходимо воспользоваться частью веб-приложения, которая выполняет этот корневой метод. Это просто выполнить, поскольку метод <tt>processRequest</tt> обрабатывает все запросы со страницы index.jsp.
 <ol>
 <li>Нажмите в веб-обозревателе кнопку &quot;Назад&quot;, чтобы вернуться на страницу <tt>http://localhost:8084/ProfilingTutorial/</tt>.<p></li>
 <li>Нажмите кнопку &quot;ОК&quot;, чтобы повторно отправить &quot;NetBeans User&quot; в качестве имени пользователя. Отклик потребует некоторого времени, поскольку средство профилирования отслеживает производительность метода <tt>processRequest</tt>.
 <li>После того как строка <b>Hello, NetBeans User!</b> появится в окне обозревателя, нажмите кнопку <img src="../../images_www/articles/win-with-netbeans/currentResultsButton.png" alt="Кнопка CurrentResults"> или выберите команды &quot;Профиль&quot; &gt; &quot;Получить текущие результаты&quot;.
 </ol>


 <h3 class="tutorial">Интерпретация графика анализа производительности</h3>
  <p>



 Средство профилирования выводит последние результаты анализа производительности, как показано на рисунке ниже.

 <p><a href="../../images_www/articles/win-with-netbeans/performanceResults.png" title="Результаты анализа производительности - щелкните для просмотра полного изображения"><img src="../../images_www/articles/win-with-netbeans/performanceResults-small.png" width="500" height="352" class="align-center" alt="Результаты анализа производительности - щелкните для просмотра полного изображения" class="b-none" style="display: block; margin-left:auto; margin-right:auto;"></a>

 <p>В верхнем окне отображается полный график вызова методов начиная с корневого. Метод <tt>processRequest</tt> выполнялся 168 мс. Обратите внимание, что на выполнение указаний метода <tt>processRequest</tt> тратится очень мало времени - в шестой строке отображается &quot;собственное время&quot; для<tt>processRequest</tt> в 0,421 мс. Большая часть времени была потрачена на выполнение методов, вызываемых методом <tt>processRequest</tt>. В частности, метод <tt>forward</tt> занял 84,7% времени выполнения. Это не удивительно, учитывая количество задач, которые должен выполнить метод <tt>forward</tt>.</p>
 <p>Польза средства профилирования NetBeans в том, что оно помогает распознать критические элементы кода, которые не предполагались или препятствуют нормальному масштабированию приложения. Обратите внимание, что метод <tt>createUniqueID</tt> занял 11,3% времени выполнения. Можно щелкнуть значок плюса рядом с записью<tt>createUniqueID</tt>, чтобы детально изучить, на что было потрачено время. Если просмотреть код относительно метода <tt>createUniqueID</tt>, обнаружится, что для него используется ужасно неэффективный алгоритм, который необходимо оптимизировать.
 <p>Окно ниже &mdash; более подробное описание, в нем отображается &quot;собственное время&quot; каждого метода на графике вызовов.</p>

</div>
<br />

<h2><a name="createObjects"></a>Мониторинг создания объектов
</h2></br><br />
<div class="indent">
<h3 class="tutorial">Переключение в режим анализа памяти</h3>
<p>

 Средство профилирования может выполнять подробный анализ (также называемый <i>измерением</i>) производительности ЦП или использования памяти, но не того и другого одновременно. Для получения подробных сведений о расположении и сборе мусора объектов а куче JVM необходимо изменить параметры средства профилирования.
 <ol>
 <li>Нажмите кнопку <img src="../../images_www/articles/win-with-netbeans/modifyProfilingButton.png" alt="Кнопка для просмотра окна изменения профилирования" > или выберите элементы &quot;Профиль&quot; &gt; &quot;Изменить профилирование&quot;.<p></li>
 <li>Нажмите кнопку &quot;Анализ использования памяти&quot;.<p></li>
 <li>Установите флажок &quot;Записать создание объекта и сбор мусора&quot;.<p></li>
 <li>Нажмите кнопку &quot;ОК&quot;. <p></li>
 </ol>

 <h3 class="tutorial">Выполнение профилированного приложения</h3>
 <p>

 После выбора анализа использования памяти необходимо воспользоваться веб-приложением, чтобы определить эффективность использования им памяти.
 <ol>
 <li>Нажмите в веб-обозревателе кнопку &quot;Назад&quot;, чтобы вернуться на страницу <tt>http://localhost:8084/ProfilingTutorial/</tt>.<p></li>
 <li>Нажмите кнопку &quot;ОК&quot;, чтобы повторно отправить &quot;NetBeans User&quot; в качестве имени пользователя. <p></li>
 <li>Как только строка <b>Hello, NetBeans User!</b> появится в обозревателе, нажмите кнопку &quot;Назад&quot;, чтобы вернуться на предыдущую страницу.<p></li>
 <li>Повторите шаги 2 и 3 девять раз. Многократная отправка одного и того же имени пользователя необходима в учебных целях.<p></li>
 <li>Нажмите кнопку <img src="../../images_www/articles/win-with-netbeans/currentResultsButton.png" alt="Кнопка CurrentResults"> или выберите команды &quot;Профиль&quot; &gt; &quot;Получить текущие результаты&quot;.<p></li>
 <li>В окне средства профилирования отобразятся результаты последнего анализа использования памяти в виде таблицы. Щелкните столбец &quot;Имя класса&quot;, чтобы отсортировать записи по имени класса.<p></li>
 <li>Прокрутите таблицу вниз до записи класса <tt>org.me.hello.NameHandler</tt>.<p></li>
 </ol>

 <h3 class="tutorial">Интерпретация графика анализа памяти</h3>
<p>
 Иллюстрация, расположенная ниже, &mdash; это статистика для класса <tt>org.me.hello.NameHandler</tt>.

<p><a href="../../images_www/articles/win-with-netbeans/liveObjects.png" title="Результаты памяти - щелкните для увеличения изображения"><img src="../../images_www/articles/win-with-netbeans/liveObjects-small.png" class="align-center" width="500" height="273" alt="Результаты памяти - щелкните для увеличения изображения" vspace=5 class="b-none" style="display: block; margin-left:auto; margin-right:auto;"></a>

 <p>В столбцах отображаются сведения о расположении объектов и использовании памяти.
 <ul>
 <li>Столбец &quot;Всего выделено объектов&quot; (крайний справа) легче всего расшифровать. Это общее число созданных объектов этого класса. Для класса <tt>NameHandler</tt> число объектов составляет 10 &mdash; это число раз, которое была нажата кнопка &quot;ОК&quot; в форме веб-приложения.<p></li>
 <li>В столбце &quot;Размещенные объекты&quot; отображается число объектов, отслеживаемых средством профилирования в настоящий момент. В этом примере из 10 созданных экземпляров <tt>NameHandler</tt> отслеживается только один. По умолчанию это число составляет примерно 10 % от общего числа размещенных объектов (поэтому числа, которые вы видите на снимке экрана, могут немного отличаться от фактических). Отслеживая только подмножество созданных объектов средство профилирования существенным образом снижает свое влияние на производительность JVM, что позволяет приложению работать практически на полной скорости.<p></li>
 <li>&quot;Живые объекты&quot; &mdash; это число размещенных объектов, которые все еще находятся в куче JVM и, следовательно, используют память.<p></li>
 <li>В двух столбцах &quot;Выделенные байты&quot; отображается объем памяти кучи, использующийся живыми объектами. В одном столбце отображается график, а во втором &mdash; описание.<p></li>
 <li>Среднее значение возраста вычисляется при помощи живых объектов. Возраст объекта &mdash; это число коллекций мусора, которые были собраны за время существования этого объекта. Суммарное значение возраста, которое делится на число живых объектов, &mdash; это среднее значение возраста.<p></li>
 <li>Значение &quot;Поколения&quot; вычисляется с использованием живых объектов. Как уже говорилось, возраст объекта &mdash; это число коллекций мусора, которые были собраны за время существования этого объекта. Значение поколения &mdash; это число различных возрастов живых объектов.<p></li>
 </ul>
 <p>Эти значения помогут вам отследить утечку памяти. Значение &quot;Поколения&quot; равно значению &quot;Сохранившиеся поколения&quot;, описанному в разделе <a href="#interpretingMonitor">Интерпретация графиков мониторинга</a>, однако ограничено объектами одного класса. Более детальный просмотр результатов мониторинга может помочь вам найти определенные объекты, которые бесполезно используют пространство кучи.  </p>

 <p>В данном примере нет необходимости проводить анализ поколений, чтобы увидеть, что проблемным классом является класс <tt>NameHandler</tt>. Значение &quot;Всего выделено объектов&quot; составляет 10. Код сервлета предназначался для повторного использования объектов <tt>NameHandler</tt> при вводе одного и того же имени пользователя. Ясно, что это не происходит. Ошибка кроется в методе <tt>processRequest</tt>: ключ, использовавшийся для проверки записи в <tt>Map</tt> является не тем же ключом, которые используется для хранения записи. Результатом стала типичная утечка памяти приложения на Java: объект размещен в <tt>Map</tt> и забыт.</p>

 <p>Другим средством для анализа поведения приложения является анализ расположения объектов определенного класса в коде. Это может помочь в предположениях о причинах нахождения объекта в куче. Средство профилирования NetBeans отобразит трассировки стеков для всех классов при щелчке записи класса в таблице правой кнопкой мыши и выборе команды &quot;Показать стек операций выделения памяти&quot;.
 </p>
 <p>Для завершения сеанса профилирования выберите команды &quot;Профиль&quot; &gt; &quot;Отсоединить&quot;.</p>
  </div>
 <br />


<h2><a name="exploring"></a>Дальнейшее изучение</h2></br><br />
<div class="indent">
<p>
   В этом учебном курсе были лишь слегка затронуты некоторые из мощнейших функций средства профилирования. Для получения дополнительных сведений просмотрите справку по средству профилирования NetBeans.
   <ul>
  <li>При профилировании использования ЦП можно определить фильтр классов для предотвращения профилирования методов вне приложения (например, все методы java.*). Это позволит приложению работать практически без потери мощности.</li><p>
  <li>Профилирование использования ЦП может повлиять на оптимизацию байткода JVM, что может вызвать несоответствие данных из отчета о работе ЦП фактической производительности. Тем не менее, существуют методы минимизации этого эффекта средства профилирования.</li><p>
 <li>Функция анализа использования памяти может быть ограничена мониторингом только размещения объектов. Это повысит влияние средства профилирования на производительность.</li><p>
  <li>Если при анализе вы выясните, что только некоторые классы вызывают проблемы, можно отключить мониторинг объектов остальных классов.</li><p>
  <li>Доступны функции мониторинга времени запуска приложения или отдельного фрагмента кода приложения.</li><p>
  <li>Доступна подробная статистика по потокам.</li><p>
  <li>Удаленное профилирование: выполняйте профилирование приложения на удаленном компьютере.</li>
 </ol>
 </div>
</body>

</html>

