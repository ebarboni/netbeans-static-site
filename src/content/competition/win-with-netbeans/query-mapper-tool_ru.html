<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Учебное руководство по средству создания отображений запросов для конкурса NetBeans</title>
<META NAME="description" CONTENT="Query Mapper Tool">
<META NAME="AUDIENCE" CONTENT="NBUSER">
<META NAME="TYPE" CONTENT="ARTICLE">
<META NAME="TOPIC" CONTENT="BASIC">
<link rel="stylesheet" type="text/css" href="../../netbeans.css">
</head>
<body >
<h1>Средство создания отображений запросов</h1>
<div class="articledate" style="margin-left:0px;">Разработано Зольтом Киссом (Zsolt Kiss) в рамках конкурса <a href="../../competition/win-with-netbeans.html">Win With NetBeans</a></div></p>
<p><a href="https://netbeans.org/projects/www/downloads?action=download&dlID=478">Загрузка файлов и исходных кодов</a></p>
<div id="contentLeft">
<table >
  <tbody>
    <tr>

      <td>
      <p>Как веб-программист, я часто сталкивался с тем, что ресурсы проекта превращаются в настоящий хаос, управлять которым невозможно. В итоге я решил создать небольшую удобную программу, которая выполняла бы поиск по исходным файлам и привязывала бы их к соответствующим ресурсам. </p>
      <p>Разработка надежного приложения на основе базы данных кажется удачным способом для сохранения операторов базы данных в одном файле свойств в форме ключ = пары значений, например  </p>
      <pre class="examplecode">		sql.t_machine.insert=insert into t_machine (id, mcname, headnum) values (?,?,?)<br>	</pre>
Для использования этой формы достаточно преобразовать файл свойств в код Java, после чего можно легко создать экземпляр объекта PreparedStatement и выполнить необходимые настройки значений, полученных из формы HTML.
      <pre class="examplecode">		Properties props = new Properties();<br>		FileInputStream in = new FileInputStream(&quot;./query.properties&quot;);<br>		props.load(in);<br>		....<br>		Connection con = DriverManager.getConnection(dbURL);<br>		String sqlUpdate = props.getProperty(&quot;sql.employees.update&quot;);<br>		PreparedStatement pstm = con.preparedStatement(sqlUpdate);<br>		pstm.setString(1, &quot;Jacob&quot;);		//обновление первого имени поля<br>		pstm.setString(2, &quot;Nielsen&quot;);		//обновление последнего имени поля<br>		pstm.setInt(3, 47);			//определение идентификатора записи в предложение 'where' оператора обновления<br>	</pre>

      <p>Однако, что делать, если в файле свойств содержатся сотни операторов, и некоторые из них превращаются в более чем один класс Java? Если что-либо в проекте изменено любым из его участников (например, счетчик параметров или порядок для запроса SQL), необходимы данные обо ВСЕХ соответствующих классах Java, JSP и страницах HTML, связанных с этим оператором, дл применения изменений. </p>
      <p>Все знают программистов баз данных и их потребности в изменении таблиц и запросов - не реже, чем разработчики Java пьют кофе! При этом нельзя забывать о постоянно меняющихся требованиях заказчиков. Поэтому ни один файл свойств не может быть статичным. По мере изменения операторов SQL должен изменяться и код! Вскоре потребуется выполнить поиск по каждому из выражений из файла свойств и классов Java для их обработки и настройки. </p>
      <p>Именно для этого и нужно интеллектуальное и удобное средство создания отображений запросов. </p>
      <p>Рассмотрим его подробнее! </p>
      <p>Используем в качестве примера небольшой пример приложения с несколькими JSP, обеспечивающими для пользователя формы для отправки, вставки, обновления и выбора операторов в базе данных. Когда пользователь запрашивает страницу, как правило, щелкая ссылку, значок, элемент меню и т.д., в фоновом режиме могут происходить многие процессы. Например, оператор выбора базы данных, который создает список или таблицу на следующем экране. Когда пользователь завершает работу на странице, обычно введя данные в элементах формы, нажмите кнопку &quot;Отправить&quot;. На веб-сервер будет отправлен новый запрос. Опять же, в одном из классов Java могут происходить операции с базой данных. </p>
      <p>Вот один из примеров неудачного действия в графическом веб-интерфейса: </p>

      <p> <img src="../../images_www/articles/win-with-netbeans/pic2.gif"  hspace="15" vspace="15"></p><p>Пользователь щелкнул элемент меню &quot;Newly Ones' Blackboard&quot; слева (выделено красным), и справа появилась страница ответов. Верхняя таблица и данные в рамке справа были получены в результате операции с базой данных. Теперь пользователь может выбрать одну запись из списка для перезаписи данных. Затем он нажимает кнопку &quot;Записать&quot; для сохранения данных в базу.<br>
Несложно представить, что если в приложении отображается большое количество страниц, для каждой из которых выполняются фоновые операции в базе данных, наступит момент, когда весь процесс разработки станет недопустимо сложным. При необходимости изменения одного-двух выражений и файлов потребуются перекрестные ссылки между GUI и элементами меню, JSP, страницами HTML, кодами Java и соответствующими операторами SQL. </p>
      </td>
    </tr>
    <tr>
      <td height="20">&nbsp;</td>
    </tr>

    <tr>
      <td>
      <h2>Средство</h2>
      <p>создания отображений запросов содержит четыре представления в JFrame, содержащие JTabbedPaneс одной вкладкой для каждого ракурса. Это следующие вкладки: </p>
      <ul>
        <li>&quot;Вид приложения&quot;;</li>
        <li>&quot;Вид свойства&quot;; </li>

        <li>&quot;Вид кода&quot;; </li>
        <li>&quot;Вид таблицы&quot;. </li>
      </ul>
</p>
<p>
<img src="../../images_www/articles/win-with-netbeans/appview.gif"  hspace="15" vspace="15" width="" height=""></p><p>
Вкладка <b>Вид приложения</b> может содержать определенную логическую последовательность приложения. В данном случае выбрана иерархия меню, однако это остается на усмотрение программиста. Если требуется найти что-либо на основе карты меню приложения или функцию, рекомендуется использовать именно эту вкладку. Узел первого уровня виде приложения соответствует представленной ранее структуре меню приложения &quot;Два аиста&quot;. При щелчке на узле отображаются два типа подузлов: на страница запроса и в форме отправки. С их помощью можно разделить операторы SQL на две группы: <i>выполняемые до визуализации</i>, результат которых отображается на следующей странице, и <i>выполняемые после отправки</i> формы. Листья на дереве - это строки свойств SQL из файла свойств. Разработчик в целом получает представление о том, какая часть данного оператора вызывается и какое действие пользователя (запрос страницы или отправка формы) приведет к выполнению запроса.

</p>
<br clear="all">
<p>
На вкладке <b>Вид свойства</b> отображаются ключи операторов SQL из файла свойств, также используемые в коде Java.</p>
<p><img src="../../images_www/articles/win-with-netbeans/propview.gif"  hspace="15" vspace="15" width="" height=""></p>
<p>
При развертывании узлов отображаются соответствующие логические записи (имена в строке меню, которых пользователь щелкает для запуска функции). На нижнем уровне существует 3 типа исходных файлов, привязанных к данному выражению. Это следующие типы:
<ul>
	<li>источник данных;</li>
	<li>метод получения;</li>
	<li>обработчик.</li>

</ul>

<b>Источник данных</b> может быть представлен любой HTML-страницей, JSP или даже сервлетом (если сервлет возвращает результат &quot;noname&quot; - динамической HTML-страницей). Обычно источники данных - это файлы (страницы), на основе которых формируются выражения, например, те, в которых пользователь может вводить значения для их отправки на сторону сервера. Отсутствие источника данных в этих случаях неудивительно (например, оператор SELECT без выражения WHERE не требует ввода и т.д.).<br><br>
В моей терминологии <b>метод получения</b> - это файл Java Или JSP, обрабатывающий значения, полученные из пользовательской формы, из источника данных. Методы получения могут выполнять проверку, но <i>они всегда выполняют замещение</i> знаков вопроса PreparedStatement данным пользователя.<br><br>
Наконец, <b>обработчики</b> - это классы Java и даже страницы JSP, обрабатывающие текущий оператор - они содержат вызовы метода <i>executeQuery(), executeUpdate(), executeBatch() и т.д.</i>.

</p>
<br clear="all">
<p>
На вкладке <b>&quot;Вид кода&quot;</b> отображается полный список файлов приложения, сгруппированных по типам. Под каждым именем файла отображаются раскрывающиеся узлы с соответствующими операторами.
</p><p>
<img src="../../images_www/articles/win-with-netbeans/codeview.gif"  hspace="15" vspace="15" width="" height=""></p><p>
При открытии вкладки &quot;Вид приложения&quot; и последующем щелчке по элементу меню можно выбрать связанный с меню оператор SQL, а затем перейти на вкладку &quot;Вид свойства&quot;. В результате выбранный оператор будет выделен на экране. Перейдите к вложенным элементам, выберите файл ресурсов, щелкните его и измените на &quot;Вид кода&quot;. На вкладке &quot;Вид кода&quot; будет отображаться выбранный ресурс и все операторы, влияющие на него. При переходу от вида к виду можно фильтровать интересующую информацию или анализировать структуры проектов с точки зрения разработчика.
</p>
<br clear="all">
<p>
<img src="../../images_www/articles/win-with-netbeans/tableview.gif"  hspace="15" vspace="15" width="" height=""></p><p>
Все это было бы бесполезно, если бы не было возможности проверить, что <i>представляет собой реальный оператор SQL</i> с точки зрения ключей файлов свойств. Для этого и нужна вкладка <b>Вид таблицы</b>. На вкладке &quot;Вид таблицы&quot; отображаются все операторы SQL выражения, сгруппированные по именам таблиц. Безусловно, здесь также приводятся первичные ссылки на ключи свойств, но при щелчке по ним отображается действительный оператор.

</p>
<br clear="all">
<p>
Далее будет описан реальный процесс разработки приложения с использованием <span style="color:red;font.weight:bold;">NetBeans 4.0</span>.
</p>

	</td>
    </tr>
    <tr>
	<td>
<p>Будут рассмотрены следующие вопросы:

</p>
<ul>
  <li><a href="#setup">Настройка нового приложения с помощью среды IDE NetBeans 4.0</a></li>
  <li><a href="#createxml">Создание файлов XML и файлов свойств для проекта</a></li>
  <li><a href="#javaclasses">Создание классов Java</a></li>
  <li><a href="#compileandrun">Компиляция и выполнение проекта</a></li>
  <li><a href="#runwithargs">Выполнение проекта с использованием аргументов командной строки</a></li>

 </ul>
<p>
<h2><a name="setup"></a>Настройка нового приложения с помощью среды IDE NetBeans 4.0</h2>

<ol>
	<li>
<p>
Выберите &quot;Файл &gt; Новый проект &gt; Общее &gt; Приложение Java&quot; и нажмите кнопку &quot;Далее&quot;.
</p>
	</li>
	<li>
<p>

Имя проекта: QueryMapperTool. Выполните поиск местоположения, где NetBeans требуется расположить папку проекта. Убедитесь в том, что флажки &quot;Установить как главный проект&quot; и &quot;Создать главный класс&quot; установлены. Введите полное имя главного класса - в данном примере использовалось имя com.zsoltkiss.qmt.QueryMapper. Однако в этом случае имя может быть любым. Нажмите кнопку &quot;Завершить&quot;. В NetBeans будет создана папка проекта по указанному пути. Убедитесь в том, что в среде IDE активированы представления проекта и файлов: нажмите CTRL+1 и CTRL+2. С помощью этих представлений в любой момент можно проверять файлы проекта, структуру пакета, классы и т.д.
</p>
	</li>
	<li>
<p>
Данное приложение использует интерфейс API JDOM, который можно загрузить по адресу <a href="http://www.jdom.org">http://www.jdom.org</a>.
</p>
	</li>
<p>
Если интерфейс API JDOM загружен, информация о нем должна поступить в NetBeans, так как он потребуется в проекте. Щелкните вкладку &quot;Проект&quot; в среде (или нажмите CTRL+1, если эта вкладка скрыта); правой кнопкой мыши щелкните имя проекта и выберите &quot;Свойства&quot;. В разделе &quot;Сборка&quot; выберите &quot;Компиляция исходных кодов&quot;. Нажмите кнопку &quot;Добавить архив JAR/папку&quot;. Теперь требуется показать папку, в которой установлен JDOM. В каталоге установки JDOM в подпапке &quot;Сборка&quot; откройте файл jdom.jar. Эти шаги следует выполнять всегда, когда требуется добавить внешний или собственный файл .jar в ресурсы проекта.
</p>
	</li>

	<li>
<p>
Также потребуются некоторые файлы .gif, файл свойств и файл XML. Файлы .gif используются в качестве значков листьев для объектов JTree. Можно создать собственный файл или использовать предоставляемые с данным учебным курсом. Создание файлов XML и файлов свойств в NetBeans достаточно просто, и скоро вы в этом убедитесь. Если эти файлы доступны, скопируйте их в папку проекта. Убедитесь в том, что после копирования они присутствуют в представлении файлов проекта.
</p>
	</li>

</ol>
</p>
<h2><a name="createxml"></a>Создание файлов XML и файлов свойств для проекта</h2>

<ol>
	<li>
<p>

Щелкните правой кнопкой мыши на имени проекта на вкладке &quot;Проект&quot; в среде IDE и выберите &quot;Создать &gt; Файл/папка&quot;. В разделе &quot;Категории&quot; в качестве типов файлов выберите &quot;Xml&quot; и нажмите кнопку &quot;Документ XML&quot;. Нажмите кнопку &quot;Далее&quot;. В качестве имени файла введите &quot;querymapping&quot;, но не указывайте местоположение. В этом случае файл размещается непосредственно в папке проекта. Нажмите кнопку &quot;Далее&quot;. На странице &quot;Выбор типа документа&quot; установите флажок &quot;Правильный документ&quot;. Нажмите кнопку &quot;Готово&quot;. 
</p>
	</li>
	<li>
<p>
Если все операции выполнены правильно, документ XML отображается в кадре редактора. Этот документ очень важен для рассматриваемого приложения. При его редактировании следует быть очень внимательными. Сначала измените корневой элемент следующим образом: <pre>&lt;query-mapping&gt;</pre> Чтобы упростить задачу, можно использовать XML из данного учебного курса. Вот небольшой его фрагмент:
<pre class="examplecode">
&lt;query-mapping&gt;
	&lt;query name=&quot;sql.crosstable.afterdate&quot; desc=&quot;Select users entered after a specified date&quot;&gt;

		&lt;app-section name=&quot;Newly Ones' Blackboard&quot; call=&quot;on-submit-form&quot;&gt;
                    	&lt;datasource src=&quot;Parameterizer.java&quot; /&gt;
                    	&lt;setter src=&quot;DoQuery.java&quot; /&gt;
                    	&lt;processor src=&quot;DoQuery.java&quot; /&gt;
                &lt;/app-section&gt;
 	&lt;/query&gt;

		...

	</pre>
При изменении не забывайте периодически сохранять документ. В данном документе XML описаны разделы приложения, например структура меню, и его связь с операторами SQL, Java, JSP и файлами HTML. Ознакомьтесь с ними - их заголовки говорят сами за себя.
</p>
	</li>
	<li>
<p>
Далее будет создан файл свойств, в которых операторам SQL присваиваются символические имена свойств. Можно использовать имя, соответствующее данному учебному курсу. На вкладке &quot;Проект&quot; щелкните правой кнопкой мыши по имени проекта, выберите &quot;Создать&quot;, &quot;Файл/папка&quot;, в разделе &quot;Категории&quot; выберите &quot;Прочее&quot; и установите типы файлов в соответствии с выбором в файле свойств. Нажмите кнопку &quot;Далее&quot;. В качестве имени файла введите &quot;query&quot; и оставьте поле ввода &quot;Папка&quot; незаполненным. Нажмите кнопку &quot;Готово&quot;. Файл свойств будет создан непосредственно в папке проекта. В представлении файлов в среде IDE можно дважды щелкнуть его имя и начать редактирование. Правой кнопкой мыши выберите язык по умолчанию и нажмите кнопку &quot;Добавить свойство&quot;. В следующем всплывающем окне можно создать необходимые пары &quot;ключ-значение&quot; для операторов SQL. Не забывайте периодически сохранять результаты работы.
</p>
	</li>

</ol>
<a name="javaclasses">Создание классов Java</a>


<ol>
	<li>
<p>
В проект можно добавлять существующие исходные файлы. Более глубоко рассмотреть код можно с использованием исходных файлов, поставляемых с данным учебным курсом. В этом случае достаточно просто скопировать необходимые файлы с каталогом в исходной папке проекта. Однако следует обращать внимание на пакеты и соответствие структуры каталога. Наиболее безопасный и эффектный способ создания нового класса - двойной щелчок на имени проекта и выбор &quot;Создать &gt; Файл/папка&quot;, а затем выбор класса Java в категориях и типа файла. На этом экране всегда есть возможность создания класса в новом пакете. В данном проекте используются два собственных пакета: com.zsoltkiss.qmt и com.zsoltkiss.qmt.util. Структура папки, соответствующая этим иерархиям, всегда создается в исходной папке проекта.
</p>
	</li>
	<li>
<p>
После создания необходимых классов можно ввести исходный код или вставить его из исходного файла, предоставляемого с данным учебным курсом.
</p>
	</li>

</ol>
<h2><a name="compileandrun"></a>Компиляция и выполнение проекта</h2>

<ol>
	<li>
<p>
Автор рекомендует использовать способ компиляции &quot;Очистить и построить&quot; или SHIFT+F11. Однако это зависит от разработчика. Те, кто предпочитают использование мыши вводу с клавиатуры, могут перейти к строке меню IDE и вызвать эту функцию в меню &quot;Сборка&quot; или щелкнув значок &quot;Очистить и построить&quot;. Сообщения о времени компиляции в среде IDE отображаются в окне вывода, которое можно активировать в любое время с помощью комбинации клавиш CTRL+4.
</p>
	</li>
	<li>
<p>
В случае успешной компиляции и сборки можно запустить проект с помощью клавиши F6, щелчком по соответствующей пиктограмме или выбрав его в меню &quot;Выполнить&quot;.
</p>

	</li>

</ol>
<h2><a name="runwithargs"></a>Выполнение проекта с использованием аргументов командной строки</h2>
<ol>
	<li>
<p>
Использование файлов свойств и файлов XML, расположенных в собственной папке проекта, не всегда является хорошим решением. Если файлы расположены по измененному пути, потребуется запустить главный класс проекта с использованием параметров командной строки. Протестируйте эту функцию! Удалите файлы query.properties и/или querymapping.xml из папки проекта и попробуйте запустить приложение. Такая попытка окажется неудачной.
</p>
	</li>
	<li>
<p>
Теперь переместите ранее удаленные файлы в любой каталог на жестком диске, кроме папки проекта. В среде IDE NetBeans в окне &quot;Проект&quot; щелкните правой кнопкой мыши имя проекта и выберите &quot;Свойства&quot;, а затем &quot;Запуск проекта&quot;. В открывшемся окне на панели справа введите в поле &quot;Аргументы&quot; соответствующие пути для каталогов, в которые были перемещены свойства и файлы XML. Сначала введите путь к файлу свойств, а затем введите пробел и, наконец, укажите путь к файлу XML. Нажмите кнопку &quot;ОК&quot; и запустите проект с помощью клавиши F6. Эта попытка должна быть успешной.
</p>
	</li>
</ol>
</td>
    </tr>
    <tr>
	<td>
Надеюсь, вам удалось успешно построить средство создания отображений запросов с самых первых шагов. Автор предпринял попытку написать полноценный код, поэтому данное руководство не задумывалось как подробное. В нем можно ознакомиться со всеми рекомендациями и при необходимости разработать собственную версию средства с использованием файлов свойств и XML. Поскольку любой разработчик всегда может создать более удачное приложение, целью автора было лишь предложить идею. Ее возможности действительно безграничны. Например, при небольшой доработке это средство можно объединить с редактором, из которого пользователь сможет напрямую открывать файлы для редактирования.<br>  В любом случае проблема, для решения которой было разработано описанное здесь средство, существует. Возможно, стоит сосредоточить ресурсы на разработке надежного и удобного инструмента для ее решения. Или оно даже сможет стать компонентом NetBeans?<br><br></td>
    </tr>
  </tbody>

</table>
</div>
</body>
</html>